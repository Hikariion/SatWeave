syntax = "proto3";
import "common.proto";
package messenger;

option go_package = "satweave/shared/task-manager";

service TaskManagerService {
  // Deploy a task to the task manager.
  rpc DeployTask(DeployTaskRequest) returns (NilResponse) {}
  rpc StartTask(StartTaskRequest) returns (NilResponse) {}
  rpc ProcessOperator(OperatorRequest) returns (NilResponse) {}
  rpc AskAvailableWorkers(NilRequest) returns (AvailableWorkersResponse) {}
  rpc RequestSlot(RequiredSlotRequest) returns (RequiredSlotResponse) {}
  rpc PushStreamData(PushStreamDataRequest) returns (NilResponse) {}
}

message PushStreamDataRequest {
  uint64 timestamp = 1;
  StreamData data = 2;
  string from = 3;
  string data_id = 4;
  uint64 worker_id = 5;
}

message RequiredSlotRequest {
  repeated RequiredSlotDescription slot_descs = 1;
}

message RequiredSlotResponse {
  Status status = 1;
  repeated int64 available_ports = 2;
}

message AvailableWorkersResponse {
  repeated uint64 workers = 1;
}

message OperatorRequest {
  // 对应的算子
  string cls_name = 1;
  // 流式计算的数据
  string data = 2;
  // 计算图的 id
  int64 graph_id = 3;
}


message DeployTaskRequest {
  ExecuteTask exec_task = 1;
}

message StartTaskRequest {

}